select topic, cursor from kanthorq_consumer where name = 'cs_1' FOR UPDATE SKIP LOCKED

SELECT
	topic, id
FROM
	kanthorq_stream
WHERE topic = topic and id > cursor
ORDER BY topic ASC, id ASC
LIMIT 10
RETURNING id

INSERT INTO
	kanthorq_job(topic, id) values(topic, id)

insert into kanthorq_consumer (name, cursor) 
select 'cs_1' as name, id as cursor from jobs order by id desc limit 1
on conflict(name) DO update set cursor = EXCLUDED.cursor; 
